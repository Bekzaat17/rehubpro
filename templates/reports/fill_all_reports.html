{% extends "base.html" %}
{% load static %}

{% block title %}–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–æ–≤{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/reports.css' %}">
{% endblock %}

{% block content %}
<h1 class="mb-4">–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–æ–≤ –∑–∞ —Å–µ–≥–æ–¥–Ω—è</h1>

<div class="report-list">
  {% for item in reports %}
    <div class="card mb-3 {% if item.is_filled %}border-success{% else %}border-danger{% endif %} shadow" id="report-card-{{ item.report_id }}">
      <div class="card-header d-flex justify-content-between align-items-center">
        <button class="text-start w-100 border-0 bg-transparent toggle-collapse-btn" type="button"
                data-bs-toggle="collapse"
                data-bs-target="#collapse-{{ item.report_id }}"
                aria-expanded="false">
          {{ forloop.counter }}. {{ item.resident.full_name }}
        </button>
      </div>
      <div id="collapse-{{ item.report_id }}" class="collapse">
        <div class="card-body">
          {% if item.can_edit %}
            <form class="report-form row" data-report-id="{{ item.report_id }}">
              {% csrf_token %}

              <!-- üìå –£–°–¢–° -->
              <div class="col-md-12 mb-4">
                <h6 class="text-muted">üìå –£–°–¢–°</h6>
                <hr>
                <div class="row">
                  {% for field in item.usts_fields %}
                    {% if field.name != "usts_comment" %}
                      <div class="col-md-6 mb-3">
                        <label class="form-label">{{ field.label }}</label>
                        {{ field }}
                        {% if field.errors %}
                          <div class="text-danger small">{{ field.errors|join:", " }}</div>
                        {% endif %}
                      </div>
                    {% endif %}
                  {% endfor %}
                </div>
                {% for field in item.usts_fields %}
                  {% if field.name == "usts_comment" %}
                    <div class="col-md-12 mb-3">
                      <label class="form-label">{{ field.label }}</label>
                      {{ field }}
                      {% if field.errors %}
                        <div class="text-danger small">{{ field.errors|join:", " }}</div>
                      {% endif %}
                    </div>
                  {% endif %}
                {% endfor %}
              </div>

              <hr class="my-4">

              <!-- üìã –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è -->
              <div class="row">
                {% for field in item.main_fields %}
                  {% if field.name != "comment" %}
                    <div class="col-md-6 mb-4">
                      <label class="form-label">{{ field.label }}</label>
                      {{ field }}
                      {% if field.errors %}
                        <div class="text-danger small">{{ field.errors|join:", " }}</div>
                      {% endif %}
                    </div>
                  {% endif %}
                {% endfor %}
              </div>

              <hr class="my-4">

              <!-- üå± –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —á–µ—Ä—Ç—ã -->
              <div class="col-md-6 mb-4">
                <h6 class="text-muted fw-bold">üå± –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —á–µ—Ä—Ç—ã</h6>
                <hr>
                <div class="form-group border rounded p-2 bg-light" style="max-height: 150px; overflow-y: auto;">
                  {{ item.positive_field }}
                </div>
              </div>

              <!-- ‚ö†Ô∏è –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —á–µ—Ä—Ç—ã -->
              <div class="col-md-6 mb-4">
                <h6 class="text-muted fw-bold">‚ö†Ô∏è –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —á–µ—Ä—Ç—ã</h6>
                <hr>
                <div class="form-group border rounded p-2 bg-light" style="max-height: 150px; overflow-y: auto;">
                  {{ item.negative_field }}
                </div>
              </div>

              <hr class="my-4">

              <!-- üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
              {% for field in item.main_fields %}
                {% if field.name == "comment" %}
                  <div class="col-md-12 mb-4">
                    <label class="form-label">{{ field.label }}</label>
                    {{ field }}
                    {% if field.errors %}
                      <div class="text-danger small">{{ field.errors|join:", " }}</div>
                    {% endif %}
                  </div>
                {% endif %}
              {% endfor %}

              <div class="col-md-12 mt-2 text-end">
                <button type="submit" class="btn btn-primary-custom">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <div id="error-box-{{ item.report_id }}" class="mt-3 alert alert-danger d-none"></div>
              </div>
            </form>
          {% else %}
            <div class="readonly-report">
              {{ item.form.as_p }}
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  {% empty %}
    <p>–ù–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è.</p>
  {% endfor %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/reports/reports.js' %}"></script>
{% endblock %}