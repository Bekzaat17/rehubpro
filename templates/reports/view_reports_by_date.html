{% extends "base.html" %}
{% load static %}

{% block title %}–ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á—ë—Ç–æ–≤{% endblock %}

{% block content %}
<h1 class="mb-4">–ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á—ë—Ç–æ–≤ –∑–∞ –¥–∞—Ç—É</h1>

<div class="row align-items-end justify-content-between mb-4">
  <form method="get" class="col-md-auto">
      <div class="input-group">
        <span class="input-group-text">–î–∞—Ç–∞</span>
        <input type="date" id="date" name="date" class="form-control" value="{{ selected_date|date:'Y-m-d' }}">
        <button type="submit" class="btn btn-secondary-custom">–ü–æ–∫–∞–∑–∞—Ç—å</button>
      </div>
  </form>

  {% if reports %}
    <div class="col-md-auto">
      <div class="dropdown">
        <button class="btn btn-outline-primary dropdown-toggle" type="button" id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          üì§ –í—ã–≥—Ä—É–∑–∏—Ç—å –æ—Ç—á—ë—Ç—ã
        </button>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="exportDropdown">
            <li><a class="dropdown-item" href="{% url 'reports:export' %}?format=txt&date={{ selected_date|date:'Y-m-d' }}">TXT</a></li>
            <li><a class="dropdown-item" href="{% url 'reports:export' %}?format=pdf&date={{ selected_date|date:'Y-m-d' }}">PDF</a></li>
        </ul>
      </div>
    </div>
  {% endif %}
</div>

<div class="accordion" id="reportsAccordion">
  {% for report in reports %}
    <div class="accordion-item mb-3 border rounded shadow overflow-hidden" id="report-{{ report.resident.id }}">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed rounded-0" type="button"
                data-bs-toggle="collapse"
                data-bs-target="#collapse-{{ report.resident.id }}"
                aria-expanded="false">
          {{ forloop.counter }}. {{ report.resident.full_name }}
        </button>
      </h2>
      <div id="collapse-{{ report.resident.id }}" class="accordion-collapse collapse">
        <div class="accordion-body">
          <div class="container-fluid">
            <div class="row mb-2"><div class="col-md-4 fw-bold">üß† –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:</div><div class="col-md-8">{{ report.emotional_state }}</div></div>
            <div class="row mb-2"><div class="col-md-4 fw-bold">üí™ –§–∏–∑–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:</div><div class="col-md-8">{{ report.physical_state }}</div></div>
            <div class="row mb-2"><div class="col-md-4 fw-bold">üéØ –ú–æ—Ç–∏–≤–∞—Ü–∏—è:</div><div class="col-md-8">{{ report.motivation }}</div></div>
            <div class="row mb-2"><div class="col-md-4 fw-bold">üìà –î–∏–Ω–∞–º–∏–∫–∞:</div><div class="col-md-8">{{ report.daily_dynamics }}</div></div>
            <div class="row mb-2"><div class="col-md-4 fw-bold">üë• –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ –ú–†–ü:</div><div class="col-md-8">{{ report.mrp_activity }}</div></div>
            <div class="row mb-2"><div class="col-md-4 fw-bold">üë®‚Äçüë©‚Äçüëß –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ —Å–µ–º—å–µ:</div><div class="col-md-8">{{ report.family_activity }}</div></div>

            <hr>

            <div class="row mb-2"><div class="col-md-4 fw-bold">üå± –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —á–µ—Ä—Ç—ã:</div><div class="col-md-8">{{ report.positive_traits }}</div></div>
            <div class="row mb-2"><div class="col-md-4 fw-bold">‚ö†Ô∏è –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —á–µ—Ä—Ç—ã:</div><div class="col-md-8">{{ report.negative_traits }}</div></div>

            <hr>

            <div class="row mb-2"><div class="col-md-4 fw-bold">üìå –£–°–¢–° ‚Äî –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ–¥–∞–≤–∞–ª:</div><div class="col-md-8">{{ report.usts_info_shared }}</div></div>
            <div class="row mb-2"><div class="col-md-4 fw-bold">üìå –£–°–¢–° ‚Äî –°–æ–±–ª—é–¥–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞:</div><div class="col-md-8">{{ report.usts_format_followed }}</div></div>
            <div class="row mb-2"><div class="col-md-4 fw-bold">üìå –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø–æ –£–°–¢–°:</div><div class="col-md-8">{{ report.usts_comment }}</div></div>

            <hr>

            <div class="row mb-2"><div class="col-md-4 fw-bold">üí¨ –û–±—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</div><div class="col-md-8">{{ report.comment }}</div></div>

            {% if report.task_comments %}
              <hr>
              <div class="row">
                <div class="col-md-12">
                  <h6 class="mt-2">üóÇ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ –∑–∞–¥–∞—á–∞–º:</h6>
                  <ul>
                    {% for task_name, comment in report.task_comments.items %}
                      <li><strong>{{ task_name }}:</strong> {{ comment }}</li>
                    {% endfor %}
                  </ul>
                </div>
              </div>
            {% endif %}

            {% if report.role_statuses %}
              <hr>
              <div class="row">
                <div class="col-md-12">
                  <h6 class="mt-2">üëî –°—Ç–∞—Ç—É—Å—ã —Ä–æ–ª–µ–π:</h6>
                  <ul>
                    {% for role_name, status in report.role_statuses.items %}
                      <li><strong>{{ role_name }}:</strong> {{ status }}</li>
                    {% endfor %}
                  </ul>
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  {% empty %}
    <p>–û—Ç—á—ë—Ç–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É –Ω–µ—Ç.</p>
  {% endfor %}
</div>
{% endblock %}